{"ast":null,"code":"var _jsxFileName = \"A:\\\\Coder-house\\\\react\\\\proyecto final\\\\my-app\\\\src\\\\components\\\\Form\\\\Form.js\",\n    _s = $RefreshSig$();\n\nimport { addDoc, collection, documentId, getDocs, query, serverTimestamp, where, writeBatch } from 'firebase/firestore';\nimport { useContext, useState } from 'react';\nimport { CartContext } from '../../Context/CartContext';\nimport { database } from '../../services/firebaseConfig';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst Form = () => {\n  _s();\n\n  const [nombre, setNombre] = useState('');\n  const [apellido, setApellido] = useState('');\n  const [gmail, setGmail] = useState('');\n  const [cargando, setCargando] = useState(false);\n  const [orderId, setOrderId] = useState('');\n  const {\n    cart,\n    total,\n    deleteAll\n  } = useContext(CartContext);\n  const precioTotal = total();\n\n  const handleSubmit = async e => {\n    setCargando(true);\n    e.preventDefault();\n\n    try {\n      const order = {\n        comprador: {\n          nombre,\n          apellido\n        },\n        items: cart,\n        total: precioTotal,\n        fecha: serverTimestamp()\n      };\n      const ids = cart.map(prod => prod.id);\n      const productsRef = collection(database, 'productos');\n      const productoAgregadoDeFS = await getDocs(query(productsRef, where(documentId(), 'in', ids)));\n      const {\n        docs\n      } = productoAgregadoDeFS;\n      const sinStock = [];\n      const batch = writeBatch(database);\n      docs.forEach(doc => {\n        const dataDoc = doc.data();\n        const stockDB = dataDoc.stock;\n        const productoAgregado = cart.find(prod => prod.id === doc.id);\n        const prodQuantity = productoAgregado === null || productoAgregado === void 0 ? void 0 : productoAgregado.cantidad;\n\n        if (stockDB >= prodQuantity) {\n          batch.update(doc.ref, {\n            stock: stockDB - prodQuantity\n          });\n        } else {\n          sinStock.push({\n            id: doc.id,\n            ...dataDoc\n          });\n        }\n      });\n\n      if (sinStock.length === 0) {\n        batch.commit();\n        const orderRef = collection(database, 'orders');\n        const orderAdded = await addDoc(orderRef, order);\n        setOrderId(orderAdded.id);\n        deleteAll();\n      } else {\n        console.log('Uno de los productos esta acabado.');\n      }\n    } catch (error) {\n      console.log(error);\n    } finally {\n      setCargando(false);\n    }\n  };\n\n  const cambiarNombre = e => {\n    setNombre(e.target.value);\n  };\n\n  const cambiarApellido = e => {\n    setApellido(e.target.value);\n  };\n\n  const cambiarGmail = e => {\n    setGmail(e.target.value);\n  };\n\n  if (orderId) {\n    return /*#__PURE__*/_jsxDEV(\"h1\", {\n      className: \"form\",\n      children: [\"Muchas Gracias por comprar en 3DLocuras,recibira su pedido pronto.Use el siguiente numero para traquear su pedido:$\", orderId]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 13\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"form1\",\n    children: /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: handleSubmit,\n      action: \"\",\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        name: \"nombre\",\n        placeholder: \"Nombre...\",\n        onChange: cambiarNombre,\n        value: nombre\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 76,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        name: \"apellido\",\n        placeholder: \"Apellido...\",\n        onChange: cambiarApellido,\n        value: apellido\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 83,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"gmail\",\n        name: \"gmail\",\n        placeholder: \"Gmail...\",\n        onChange: cambiarGmail,\n        value: gmail\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        children: cargando ? 'Enviando...' : 'Enviar'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 74,\n    columnNumber: 9\n  }, this);\n};\n\n_s(Form, \"XuaeyqeDmwYI3Q/uahUaVcFJfe8=\");\n\n_c = Form;\nexport default Form;\n\nvar _c;\n\n$RefreshReg$(_c, \"Form\");","map":{"version":3,"names":["addDoc","collection","documentId","getDocs","query","serverTimestamp","where","writeBatch","useContext","useState","CartContext","database","Form","nombre","setNombre","apellido","setApellido","gmail","setGmail","cargando","setCargando","orderId","setOrderId","cart","total","deleteAll","precioTotal","handleSubmit","e","preventDefault","order","comprador","items","fecha","ids","map","prod","id","productsRef","productoAgregadoDeFS","docs","sinStock","batch","forEach","doc","dataDoc","data","stockDB","stock","productoAgregado","find","prodQuantity","cantidad","update","ref","push","length","commit","orderRef","orderAdded","console","log","error","cambiarNombre","target","value","cambiarApellido","cambiarGmail"],"sources":["A:/Coder-house/react/proyecto final/my-app/src/components/Form/Form.js"],"sourcesContent":["import {addDoc,collection,documentId,getDocs,query,serverTimestamp,where,writeBatch,} from 'firebase/firestore';\r\nimport { useContext, useState } from 'react';\r\nimport { CartContext } from '../../Context/CartContext';\r\nimport { database} from '../../services/firebaseConfig';\r\n\r\nconst Form = () => {\r\n    const [nombre, setNombre] = useState('');\r\n    const [apellido, setApellido] = useState('');\r\n    const [gmail, setGmail] = useState('');\r\n    const [cargando, setCargando] = useState(false);\r\n    const [orderId, setOrderId] = useState('');\r\n    const { cart, total, deleteAll } = useContext(CartContext);\r\n    const precioTotal = total();\r\n    const handleSubmit = async (e) => {\r\n        setCargando(true);\r\n        e.preventDefault();\r\n        try {\r\n            const order = {\r\n                comprador: { nombre, apellido },\r\n                items: cart,\r\n                total: precioTotal,\r\n                fecha: serverTimestamp(),\r\n            };\r\n        const ids = cart.map((prod) => prod.id);\r\n        const productsRef = collection(database, 'productos');\r\n         const productoAgregadoDeFS = await getDocs(\r\n                query(productsRef, where(documentId(), 'in', ids))\r\n            );\r\n\r\n            const {docs} = productoAgregadoDeFS;\r\n            const sinStock = [];\r\n            const batch = writeBatch(database);\r\n\r\n            docs.forEach((doc) => {\r\n                const dataDoc = doc.data();\r\n                const stockDB = dataDoc.stock;\r\n\r\n                const productoAgregado = cart.find(\r\n                    (prod) => prod.id === doc.id\r\n                );\r\n\r\n        const prodQuantity = productoAgregado?.cantidad;\r\n            if (stockDB >= prodQuantity) {\r\n                    batch.update(doc.ref, { stock: stockDB - prodQuantity });\r\n                } else {\r\n                    sinStock.push({ id: doc.id, ...dataDoc });\r\n                }\r\n            });\r\n            if (sinStock.length === 0) {\r\n                batch.commit();\r\n                const orderRef = collection(database, 'orders');\r\n                const orderAdded = await addDoc(orderRef, order);\r\n                setOrderId(orderAdded.id);\r\n                deleteAll();\r\n            } else {\r\n                console.log('Uno de los productos esta acabado.');\r\n            }\r\n        } catch (error) {\r\n            console.log(error);\r\n        } finally {\r\n            setCargando(false);\r\n        }\r\n    };\r\n\r\n    const cambiarNombre=(e)=>{setNombre(e.target.value);};\r\n    const cambiarApellido=(e)=>{setApellido(e.target.value);};\r\n    const cambiarGmail=(e)=>{setGmail(e.target.value);};\r\n    if (orderId) {\r\n        return (\r\n            <h1 className='form'>Muchas Gracias por comprar en 3DLocuras,recibira su pedido pronto.Use el siguiente numero para traquear su pedido:${orderId}</h1>\r\n        );\r\n    }\r\n    return (\r\n        <div className='form1'>\r\n            <form onSubmit={handleSubmit} action=\"\">\r\n                <input\r\n                    type=\"text\"\r\n                    name=\"nombre\"\r\n                    placeholder=\"Nombre...\"\r\n                    onChange={cambiarNombre}\r\n                    value={nombre}\r\n                />\r\n                <input\r\n                    type=\"text\"\r\n                    name=\"apellido\"\r\n                    placeholder=\"Apellido...\"\r\n                    onChange={cambiarApellido}\r\n                    value={apellido}\r\n                />\r\n                <input\r\n                    type=\"gmail\"\r\n                    name=\"gmail\"\r\n                    placeholder=\"Gmail...\"\r\n                    onChange={cambiarGmail}\r\n                    value={gmail}\r\n                />\r\n                <button>{cargando ? 'Enviando...' : 'Enviar'}</button>\r\n            </form>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Form;"],"mappings":";;;AAAA,SAAQA,MAAR,EAAeC,UAAf,EAA0BC,UAA1B,EAAqCC,OAArC,EAA6CC,KAA7C,EAAmDC,eAAnD,EAAmEC,KAAnE,EAAyEC,UAAzE,QAA2F,oBAA3F;AACA,SAASC,UAAT,EAAqBC,QAArB,QAAqC,OAArC;AACA,SAASC,WAAT,QAA4B,2BAA5B;AACA,SAASC,QAAT,QAAwB,+BAAxB;;;AAEA,MAAMC,IAAI,GAAG,MAAM;EAAA;;EACf,MAAM,CAACC,MAAD,EAASC,SAAT,IAAsBL,QAAQ,CAAC,EAAD,CAApC;EACA,MAAM,CAACM,QAAD,EAAWC,WAAX,IAA0BP,QAAQ,CAAC,EAAD,CAAxC;EACA,MAAM,CAACQ,KAAD,EAAQC,QAAR,IAAoBT,QAAQ,CAAC,EAAD,CAAlC;EACA,MAAM,CAACU,QAAD,EAAWC,WAAX,IAA0BX,QAAQ,CAAC,KAAD,CAAxC;EACA,MAAM,CAACY,OAAD,EAAUC,UAAV,IAAwBb,QAAQ,CAAC,EAAD,CAAtC;EACA,MAAM;IAAEc,IAAF;IAAQC,KAAR;IAAeC;EAAf,IAA6BjB,UAAU,CAACE,WAAD,CAA7C;EACA,MAAMgB,WAAW,GAAGF,KAAK,EAAzB;;EACA,MAAMG,YAAY,GAAG,MAAOC,CAAP,IAAa;IAC9BR,WAAW,CAAC,IAAD,CAAX;IACAQ,CAAC,CAACC,cAAF;;IACA,IAAI;MACA,MAAMC,KAAK,GAAG;QACVC,SAAS,EAAE;UAAElB,MAAF;UAAUE;QAAV,CADD;QAEViB,KAAK,EAAET,IAFG;QAGVC,KAAK,EAAEE,WAHG;QAIVO,KAAK,EAAE5B,eAAe;MAJZ,CAAd;MAMJ,MAAM6B,GAAG,GAAGX,IAAI,CAACY,GAAL,CAAUC,IAAD,IAAUA,IAAI,CAACC,EAAxB,CAAZ;MACA,MAAMC,WAAW,GAAGrC,UAAU,CAACU,QAAD,EAAW,WAAX,CAA9B;MACC,MAAM4B,oBAAoB,GAAG,MAAMpC,OAAO,CACnCC,KAAK,CAACkC,WAAD,EAAchC,KAAK,CAACJ,UAAU,EAAX,EAAe,IAAf,EAAqBgC,GAArB,CAAnB,CAD8B,CAA1C;MAIG,MAAM;QAACM;MAAD,IAASD,oBAAf;MACA,MAAME,QAAQ,GAAG,EAAjB;MACA,MAAMC,KAAK,GAAGnC,UAAU,CAACI,QAAD,CAAxB;MAEA6B,IAAI,CAACG,OAAL,CAAcC,GAAD,IAAS;QAClB,MAAMC,OAAO,GAAGD,GAAG,CAACE,IAAJ,EAAhB;QACA,MAAMC,OAAO,GAAGF,OAAO,CAACG,KAAxB;QAEA,MAAMC,gBAAgB,GAAG1B,IAAI,CAAC2B,IAAL,CACpBd,IAAD,IAAUA,IAAI,CAACC,EAAL,KAAYO,GAAG,CAACP,EADL,CAAzB;QAIR,MAAMc,YAAY,GAAGF,gBAAH,aAAGA,gBAAH,uBAAGA,gBAAgB,CAAEG,QAAvC;;QACI,IAAIL,OAAO,IAAII,YAAf,EAA6B;UACrBT,KAAK,CAACW,MAAN,CAAaT,GAAG,CAACU,GAAjB,EAAsB;YAAEN,KAAK,EAAED,OAAO,GAAGI;UAAnB,CAAtB;QACH,CAFL,MAEW;UACHV,QAAQ,CAACc,IAAT,CAAc;YAAElB,EAAE,EAAEO,GAAG,CAACP,EAAV;YAAc,GAAGQ;UAAjB,CAAd;QACH;MACJ,CAdD;;MAeA,IAAIJ,QAAQ,CAACe,MAAT,KAAoB,CAAxB,EAA2B;QACvBd,KAAK,CAACe,MAAN;QACA,MAAMC,QAAQ,GAAGzD,UAAU,CAACU,QAAD,EAAW,QAAX,CAA3B;QACA,MAAMgD,UAAU,GAAG,MAAM3D,MAAM,CAAC0D,QAAD,EAAW5B,KAAX,CAA/B;QACAR,UAAU,CAACqC,UAAU,CAACtB,EAAZ,CAAV;QACAZ,SAAS;MACZ,CAND,MAMO;QACHmC,OAAO,CAACC,GAAR,CAAY,oCAAZ;MACH;IACJ,CAzCD,CAyCE,OAAOC,KAAP,EAAc;MACZF,OAAO,CAACC,GAAR,CAAYC,KAAZ;IACH,CA3CD,SA2CU;MACN1C,WAAW,CAAC,KAAD,CAAX;IACH;EACJ,CAjDD;;EAmDA,MAAM2C,aAAa,GAAEnC,CAAD,IAAK;IAACd,SAAS,CAACc,CAAC,CAACoC,MAAF,CAASC,KAAV,CAAT;EAA2B,CAArD;;EACA,MAAMC,eAAe,GAAEtC,CAAD,IAAK;IAACZ,WAAW,CAACY,CAAC,CAACoC,MAAF,CAASC,KAAV,CAAX;EAA6B,CAAzD;;EACA,MAAME,YAAY,GAAEvC,CAAD,IAAK;IAACV,QAAQ,CAACU,CAAC,CAACoC,MAAF,CAASC,KAAV,CAAR;EAA0B,CAAnD;;EACA,IAAI5C,OAAJ,EAAa;IACT,oBACI;MAAI,SAAS,EAAC,MAAd;MAAA,kIAAyIA,OAAzI;IAAA;MAAA;MAAA;MAAA;IAAA,QADJ;EAGH;;EACD,oBACI;IAAK,SAAS,EAAC,OAAf;IAAA,uBACI;MAAM,QAAQ,EAAEM,YAAhB;MAA8B,MAAM,EAAC,EAArC;MAAA,wBACI;QACI,IAAI,EAAC,MADT;QAEI,IAAI,EAAC,QAFT;QAGI,WAAW,EAAC,WAHhB;QAII,QAAQ,EAAEoC,aAJd;QAKI,KAAK,EAAElD;MALX;QAAA;QAAA;QAAA;MAAA,QADJ,eAQI;QACI,IAAI,EAAC,MADT;QAEI,IAAI,EAAC,UAFT;QAGI,WAAW,EAAC,aAHhB;QAII,QAAQ,EAAEqD,eAJd;QAKI,KAAK,EAAEnD;MALX;QAAA;QAAA;QAAA;MAAA,QARJ,eAeI;QACI,IAAI,EAAC,OADT;QAEI,IAAI,EAAC,OAFT;QAGI,WAAW,EAAC,UAHhB;QAII,QAAQ,EAAEoD,YAJd;QAKI,KAAK,EAAElD;MALX;QAAA;QAAA;QAAA;MAAA,QAfJ,eAsBI;QAAA,UAASE,QAAQ,GAAG,aAAH,GAAmB;MAApC;QAAA;QAAA;QAAA;MAAA,QAtBJ;IAAA;MAAA;MAAA;MAAA;IAAA;EADJ;IAAA;IAAA;IAAA;EAAA,QADJ;AA4BH,CA/FD;;GAAMP,I;;KAAAA,I;AAiGN,eAAeA,IAAf"},"metadata":{},"sourceType":"module"}